<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Sign In ‚Äî PawCare</title>
<link href="https://fonts.googleapis.com/css2?family=Playfair+Display:ital,wght@0,400;0,700;0,900;1,400;1,700&family=Instrument+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --forest:        #1e3a2f;
  --forest-mid:    #2d5040;
  --leaf:          #4a7c59;
  --sage:          #7aaa85;
  --mint:          #b8d4bd;
  --cream:         #f8f3ec;
  --parchment:     #ede5d8;
  --sand:          #d6c9b5;
  --amber:         #c8843a;
  --amber-light:   #e8b87a;
  --white:         #fefcf9;
  --text:          #1a1510;
  --text-mid:      #4a3f35;
  --text-light:    #8a7b6e;
  --danger:        #b94040;
  --danger-bg:     #fdf0f0;
  --success:       #4a7c59;
  --success-bg:    #e6f4ea;
}

*, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

body {
  font-family: 'Instrument Sans', sans-serif;
  background: var(--forest);
  color: var(--text);
  min-height: 100vh;
  display: flex;
  align-items: center;
  justify-content: center;
  position: relative;
  overflow: hidden;
}

/* Background decoration */
.bg-decoration {
  position: absolute;
  inset: 0;
  overflow: hidden;
  z-index: 0;
}
.blob {
  position: absolute;
  border-radius: 50%;
  filter: blur(80px);
  opacity: 0.15;
}
.blob-1 { width: 500px; height: 500px; background: var(--sage); top: -100px; right: -100px; animation: float1 12s ease-in-out infinite; }
.blob-2 { width: 400px; height: 400px; background: var(--amber); bottom: -50px; left: -100px; animation: float2 15s ease-in-out infinite; }
@keyframes float1 { 0%,100%{transform:translate(0,0)} 50%{transform:translate(-30px,40px)} }
@keyframes float2 { 0%,100%{transform:translate(0,0)} 50%{transform:translate(40px,-30px)} }

/* Auth container */
.auth-container {
  position: relative;
  z-index: 1;
  width: 100%;
  max-width: 440px;
  padding: 20px;
}

.auth-card {
  background: var(--white);
  border-radius: 24px;
  padding: 44px 40px;
  box-shadow: 0 24px 64px rgba(0,0,0,0.3);
  border: 1px solid rgba(255,255,255,0.1);
}

.auth-logo {
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 10px;
  margin-bottom: 32px;
}
.logo-paw {
  width: 44px; height: 44px;
  background: var(--sage);
  border-radius: 12px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 1.3rem;
}
.logo-text {
  font-family: 'Playfair Display', serif;
  font-size: 1.6rem;
  font-weight: 700;
  color: var(--forest);
}

.auth-title {
  font-family: 'Playfair Display', serif;
  font-size: 1.8rem;
  font-weight: 700;
  color: var(--forest);
  text-align: center;
  margin-bottom: 8px;
}

.auth-subtitle {
  text-align: center;
  color: var(--text-light);
  font-size: 0.9rem;
  margin-bottom: 32px;
}

/* Tabs */
.auth-tabs {
  display: flex;
  gap: 8px;
  background: var(--parchment);
  padding: 4px;
  border-radius: 12px;
  margin-bottom: 28px;
}
.auth-tab {
  flex: 1;
  padding: 10px;
  border-radius: 9px;
  font-size: 0.88rem;
  font-weight: 600;
  color: var(--text-mid);
  background: transparent;
  border: none;
  cursor: pointer;
  transition: all 0.2s;
  font-family: 'Instrument Sans', sans-serif;
}
.auth-tab.active {
  background: white;
  color: var(--forest);
  box-shadow: 0 2px 8px rgba(0,0,0,0.08);
}

/* Forms */
.auth-form {
  display: none;
}
.auth-form.active {
  display: block;
  animation: fadeIn 0.3s ease;
}
@keyframes fadeIn { from { opacity:0; transform:translateY(10px); } to { opacity:1; transform:translateY(0); } }

.form-group {
  margin-bottom: 20px;
}
.form-label {
  display: block;
  font-size: 0.85rem;
  font-weight: 600;
  color: var(--text-mid);
  margin-bottom: 8px;
}
.form-input {
  width: 100%;
  padding: 12px 16px;
  border: 1px solid var(--sand);
  border-radius: 10px;
  font-size: 0.9rem;
  font-family: 'Instrument Sans', sans-serif;
  color: var(--text);
  background: var(--cream);
  transition: all 0.2s;
  outline: none;
}
.form-input:focus {
  border-color: var(--sage);
  background: white;
  box-shadow: 0 0 0 3px rgba(122,170,133,0.15);
}
.form-input::placeholder {
  color: var(--text-light);
}
select.form-input {
  cursor: pointer;
  appearance: none;
  background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 12 12'%3E%3Cpath fill='%234a3f35' d='M6 9L1 4h10z'/%3E%3C/svg%3E");
  background-repeat: no-repeat;
  background-position: right 14px center;
  padding-right: 40px;
}
select.form-input option {
  padding: 10px;
}

.btn-submit {
  width: 100%;
  padding: 14px;
  background: var(--forest);
  color: white;
  border: none;
  border-radius: 12px;
  font-size: 0.95rem;
  font-weight: 600;
  font-family: 'Instrument Sans', sans-serif;
  cursor: pointer;
  transition: all 0.2s;
  margin-top: 8px;
}
.btn-submit:hover {
  background: var(--forest-mid);
  transform: translateY(-1px);
  box-shadow: 0 8px 20px rgba(30,58,47,0.3);
}
.btn-submit:disabled {
  opacity: 0.6;
  cursor: not-allowed;
  transform: none;
}

.auth-divider {
  text-align: center;
  margin: 24px 0;
  color: var(--text-light);
  font-size: 0.82rem;
  position: relative;
}
.auth-divider::before,
.auth-divider::after {
  content: '';
  position: absolute;
  top: 50%;
  width: 40%;
  height: 1px;
  background: var(--sand);
}
.auth-divider::before { left: 0; }
.auth-divider::after { right: 0; }

.auth-footer {
  text-align: center;
  margin-top: 24px;
  font-size: 0.85rem;
  color: var(--text-light);
}
.auth-footer a {
  color: var(--leaf);
  text-decoration: none;
  font-weight: 600;
}
.auth-footer a:hover {
  color: var(--forest);
  text-decoration: underline;
}

/* Alert messages */
.alert {
  padding: 12px 16px;
  border-radius: 10px;
  margin-bottom: 20px;
  font-size: 0.85rem;
  display: none;
  animation: slideDown 0.3s ease;
}
@keyframes slideDown { from { opacity:0; transform:translateY(-10px); } to { opacity:1; transform:translateY(0); } }
.alert.show { display: block; }
.alert-error {
  background: var(--danger-bg);
  color: var(--danger);
  border: 1px solid var(--danger);
}
.alert-success {
  background: var(--success-bg);
  color: var(--success);
  border: 1px solid var(--success);
}

.back-link {
  position: absolute;
  top: 24px;
  left: 24px;
  color: rgba(255,255,255,0.7);
  text-decoration: none;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 6px;
  transition: color 0.2s;
  z-index: 10;
}
.back-link:hover {
  color: white;
}

@media (max-width: 768px) {
  .auth-card {
    padding: 32px 24px;
  }
}
</style>
</head>
<body>

<div class="bg-decoration">
  <div class="blob blob-1"></div>
  <div class="blob blob-2"></div>
</div>

<a href="/landing.html" class="back-link">
  ‚Üê Back to Home
</a>

<div class="auth-container">
  <div class="auth-card">
    <div class="auth-logo">
      <div class="logo-paw">üêæ</div>
      <div class="logo-text">PawCare</div>
    </div>

    <h1 class="auth-title">Welcome</h1>
    <p class="auth-subtitle">Sign in to manage your pet's appointments</p>

    <!-- Alert messages -->
    <div id="alert" class="alert"></div>

    <!-- Tabs -->
    <div class="auth-tabs">
      <button class="auth-tab active" onclick="switchTab('login')">Sign In</button>
      <button class="auth-tab" onclick="switchTab('register')">Register</button>
    </div>

    <!-- Login Form -->
    <form id="login-form" class="auth-form active" onsubmit="handleLogin(event)">
      <div class="form-group">
        <label class="form-label" for="login-email">Email</label>
        <input 
          type="email" 
          id="login-email" 
          class="form-input" 
          placeholder="your@email.com"
          required
        >
      </div>
      <div class="form-group">
        <label class="form-label" for="login-password">Password</label>
        <input 
          type="password" 
          id="login-password" 
          class="form-input" 
          placeholder="Enter your password"
          required
        >
      </div>
      <button type="submit" class="btn-submit" id="login-btn">
        Sign In
      </button>
    </form>

    <!-- Register Form -->
    <form id="register-form" class="auth-form" onsubmit="handleRegister(event)">
      <div class="form-group">
        <label class="form-label" for="register-name">Full Name</label>
        <input 
          type="text" 
          id="register-name" 
          class="form-input" 
          placeholder="John Doe"
          required
        >
      </div>
      <div class="form-group">
        <label class="form-label" for="register-email">Email</label>
        <input 
          type="email" 
          id="register-email" 
          class="form-input" 
          placeholder="your@email.com"
          required
        >
      </div>
      <div class="form-group">
        <label class="form-label" for="register-password">Password</label>
        <input 
          type="password" 
          id="register-password" 
          class="form-input" 
          placeholder="At least 8 characters"
          minlength="8"
          required
        >
      </div>
      <div class="form-group">
        <label class="form-label" for="register-confirm">Confirm Password</label>
        <input 
          type="password" 
          id="register-confirm" 
          class="form-input" 
          placeholder="Re-enter your password"
          minlength="8"
          required
        >
      </div>
      <button type="submit" class="btn-submit" id="register-btn">
        Create Account
      </button>
    </form>

    <div class="auth-footer">
      <p>By continuing, you agree to our Terms of Service and Privacy Policy</p>
    </div>
  </div>
</div>

<script>
// API Configuration
const API_BASE_URL =
  location.hostname.includes("localhost")
    ? "http://localhost:8000"
    : "https://vet-scheduling-uiob.onrender.com";
    
// Tab switching
function switchTab(tab) {
  const tabs = document.querySelectorAll('.auth-tab');
  const forms = document.querySelectorAll('.auth-form');
  
  tabs.forEach(t => t.classList.remove('active'));
  forms.forEach(f => f.classList.remove('active'));
  
  if (tab === 'login') {
    tabs[0].classList.add('active');
    document.getElementById('login-form').classList.add('active');
  } else {
    tabs[1].classList.add('active');
    document.getElementById('register-form').classList.add('active');
  }
  
  hideAlert();
}

// Alert functions
function showAlert(message, type = 'error') {
  const alert = document.getElementById('alert');
  alert.textContent = message;
  alert.className = `alert alert-${type} show`;
}

function hideAlert() {
  const alert = document.getElementById('alert');
  alert.classList.remove('show');
}

// Handle Login
async function handleLogin(event) {
  event.preventDefault();
  hideAlert();
  
  const email = document.getElementById('login-email').value;
  const password = document.getElementById('login-password').value;
  const btn = document.getElementById('login-btn');
  
  btn.disabled = true;
  btn.textContent = 'Signing in...';
  
  try {
    const response = await fetch(`${API_BASE_URL}/api/v1/auth/login`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({ email, password })
    });
    
    const data = await response.json();
    
    if (response.ok) {
      console.log('Login successful, storing token and redirecting...');
      
      // Store token
      localStorage.setItem('access_token', data.access_token);
      
      // Show success
      showAlert('Login successful! Redirecting...', 'success');
      
      // Force redirect immediately
      console.log('Redirecting to /app.html');
      window.location.replace('/app.html');
    } else {
      console.error('Login failed:', data);
      showAlert(data.detail || 'Invalid email or password');
      btn.disabled = false;
      btn.textContent = 'Sign In';
    }
  } catch (error) {
    console.error('Login error:', error);
    showAlert('Connection error. Please make sure the backend is running.');
    btn.disabled = false;
    btn.textContent = 'Sign In';
  }
}

// Handle Register
async function handleRegister(event) {
  event.preventDefault();
  hideAlert();
  
  const fullName = document.getElementById('register-name').value;
  const email = document.getElementById('register-email').value;
  const password = document.getElementById('register-password').value;
  const confirmPassword = document.getElementById('register-confirm').value;
  const btn = document.getElementById('register-btn');
  
  // Validate passwords match
  if (password !== confirmPassword) {
    showAlert('Passwords do not match');
    return;
  }
  
  btn.disabled = true;
  btn.textContent = 'Creating account...';
  
  console.log('Registering user:', { email });
  
  try {
    const response = await fetch(`${API_BASE_URL}/api/v1/auth/register`, {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json',
      },
      body: JSON.stringify({
        full_name: fullName,
        email: email,
        password
      })
    });
    
    const data = await response.json();
    
    if (response.ok) {
      console.log('Registration successful, storing token and redirecting...');
      
      // Store token (auto-login after registration)
      localStorage.setItem('access_token', data.access_token);
      
      // Show success
      showAlert('Account created successfully! Redirecting...', 'success');
      
      // Force redirect immediately
      console.log('Redirecting to /app.html');
      window.location.replace('/app.html');
    } else {
      console.error('Registration failed:', data);
      showAlert(data.detail || 'Registration failed. Please try again.');
      btn.disabled = false;
      btn.textContent = 'Create Account';
    }
  } catch (error) {
    console.error('Register error:', error);
    showAlert('Connection error. Please make sure the backend is running.');
    btn.disabled = false;
    btn.textContent = 'Create Account';
  }
}

// Check if already logged in
window.addEventListener('DOMContentLoaded', () => {
  const token = localStorage.getItem('access_token');
  if (token) {
    console.log('Token found, verifying...');
    // Verify token is still valid
    fetch(`${API_BASE_URL}/api/v1/users/profile`, {
      headers: {
        'Authorization': `Bearer ${token}`
      }
    })
    .then(response => {
      if (response.ok) {
        console.log('Token valid, redirecting to app');
        window.location.replace('/app.html');
      } else {
        console.log('Token invalid, clearing storage');
        localStorage.removeItem('access_token');
      }
    })
    .catch((error) => {
      console.error('Token verification failed:', error);
      localStorage.removeItem('access_token');
    });
  }
});
</script>

</body>
</html>
